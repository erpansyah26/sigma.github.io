<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Papan Game Edukasi LUSIANA</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-image: url("image/background.png");
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;

            min-height: 100vh;
            overflow-y: auto;
            display: flex;
            justify-content: center;
            padding: 20px;
        }

        /*--- Pilihan Kartu ---*/
        #setup-overlay::before {
            content: "";
            position: fixed;
            inset: 0;
            background-image: url("image/background.png");
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            z-index: -1;
        }

        #setup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            z-index: 2000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            transition: opacity 0.8s ease, visibility 0.8s;
        }

        #setup-overlay.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }

        .setup-container {
            text-align: center;
            max-width: 800px;
            width: 100%;
        }

        .setup-title {
            font-size: 2rem;
            color: #2c3e50;
            margin-bottom: 10px;
            font-weight: 800;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        }

        .setup-instruction {
            font-size: 1.2rem;
            color: #555;
            margin-bottom: 30px;
            min-height: 1.5em;
            font-weight: bold;
            background: white;
            padding: 10px 20px;
            border-radius: 50px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            display: inline-block;
        }

        .card-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-top: 20px;
        }

        .white-card {
            aspect-ratio: 3/4;
            background-color: #ffffff;
            border: 4px solid #ddd;
            border-radius: 12px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow: hidden;
        }

        .white-card:hover:not(.picked) {
            transform: translateY(-10px) scale(1.05);
            border-color: #bbb;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
        }

        .white-card.picked {
            cursor: default;
            transform: scale(1);
            border-color: transparent;
        }

        .card-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            padding: 10px;
        }

        .card-icon {
            font-size: 3rem;
            margin-bottom: 10px;
            color: #eee;
        }

        .card-label {
            font-size: 1.5rem;
            font-weight: bold;
            color: #333;
            text-transform: uppercase;
        }

        .card-player-num {
            font-size: 1rem;
            margin-top: 5px;
            background: rgba(0, 0, 0, 0.2);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
        }

        /* --- Style Tombol Home --- */
 .home-btn {
  max-width: 200px;
  height: auto;
  cursor: pointer;


  transform: translateY(10px);

  transition: transform 0.2s, filter 0.2s;
  filter: drop-shadow(0 4px 6px rgba(0,0,0,0.3));
  border-radius: 8px;
}

.home-btn:hover {

  transform: translateY(10px) scale(1.05);

  filter: drop-shadow(0 6px 8px rgba(0,0,0,0.4));
}

.home-btn:active {

  transform: translateY(14px) scale(0.95);
}


        /* --- CONTAINER UTAMA (GRID 3 BAGIAN) --- */
        .main-layout {
            display: grid;
            grid-template-columns: 2fr 1fr;
            grid-template-rows: auto auto auto;
            gap: 20px;
            width: 100%;
            max-width: 1200px;
        }

        .area-board {
            grid-column: 1;
            grid-row: 1;
        }

        .area-sidebar {
            grid-column: 2;
            grid-row: 1;
        }

        .area-dice {
            grid-column: 1 / -1;
            grid-row: 2;
            display: flex;
            justify-content: center;
        }

        .area-footer {
            grid-column: 1 / -1; 
            grid-row: 3; 
            display: flex;
            justify-content: center;
            align-items: center;
            padding-bottom: 10px;
        }

        /* --- BAGIAN 1: PAPAN --- */
        .board-container {
            display: flex;
            justify-content: center;
            align-items: center;
            background: rgba(251, 250, 250, 0.221);
            backdrop-filter: blur(1.5px);
            -webkit-backdrop-filter: blur(1.5px);
            padding: 10px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .board {
            position: relative;
            width: 100%;
            max-width: 600px;
            aspect-ratio: 1 / 1;
            background-color: #ffffff;
            border: 4px solid #000000;
            padding: 15px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr 1fr;
            gap: 10px;
            border-radius: 8px;
        }

        .zone {
            border: 2px solid #000000;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(4, 1fr);
            gap: 5px;
            padding: 5px;
            position: relative;
            border-radius: 8px;
        }

        .coklat {
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        .abu {
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        .merah {
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        .biru {
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        .box {
            background-color: rgba(255, 255, 255, 0.7);
            border: 2px solid #00000092;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow: visible;
            font-size: 1.2rem;
            font-weight: bold;
            color: #000;
            position: relative;
            border-radius: 4px;
        }

        .start-box {
            padding: 1px;
            font-size: 0.6rem;
            line-height: 1;
            white-space: normal;
            word-break: break-word;
            text-align: center;
        }

        .start-box span {
            font-size: 0.7rem;
            display: block;
        }

        .finish-box {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90px;
            height: 90px;
            border: 4px solid #000000;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            z-index: 5;
            font-size: 1.2rem;
            border-radius: 8%;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }

        .token {
            width: 69px;
            height: 69px;
            position: absolute;
            z-index: 20;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            background-color: transparent;
            transition: top 0.4s ease, left 0.4s ease, transform 0.3s;
        }

        .token-dead {
            filter: grayscale(100%) blur(1px);
            opacity: 0.5;
            transform: scale(0.8) !important;
        }

        /* --- BAGIAN 2: SIDEBAR --- */
        .sidebar {
            background: rgba(251, 250, 250, 0.221);
            backdrop-filter: blur(1.5px);
            -webkit-backdrop-filter: blur(1.5px);
            border: 2px solid rgba(255, 255, 255, 0.4);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .panel-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 15px;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
            color: #333;
            text-align: center;
        }

        .player-list {
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: 15px;
            flex-grow: 1;
            overflow-y: auto;
        }

        .player-card {
            display: flex;
            align-items: center;
            padding: 12px;
            border-radius: 8px;
            background: #f9f9f9;
            border: 2px solid transparent;
            transition: all 0.3s;
        }

        .player-card.active {
            border-color: #27ae60;
            background: #eafaf1;
            transform: scale(1.02);
            box-shadow: 0 2px 8px rgba(39, 174, 96, 0.2);
        }

        .player-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            margin-right: 15px;
            border: 2px solid #ddd;
            flex-shrink: 0;
        }

        .player-info {
            flex-grow: 1;
        }

        .player-name {
            font-weight: bold;
            font-size: 1rem;
            color: #333;
        }

        .player-status {
            font-size: 0.85rem;
            color: #666;
            margin-top: 4px;
        }

        /* --- BAGIAN 3: DADU --- */
        .dice-section {
            background: rgba(251, 250, 250, 0.221);
            backdrop-filter: blur(1.5px);
            -webkit-backdrop-filter: blur(1.5px);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 -5px 20px rgba(0, 0, 0, 0.05);
            border: 1px solid #ddd;
            margin-bottom: 20px;
        }

        .dice-btn-large {
            background: transparent;
            border: none;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            transition: transform 0.2s;
        }

        .dice-btn-large:hover {
            transform: scale(1.05);
        }

        .dice-btn-large:active {
            transform: scale(0.95);
        }

        .dice-btn-large:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            filter: grayscale(100%);
            transform: none;
        }

        .dice-visual-container {
            width: 70px;
            height: 70px;
            background-color: #ffffff;
            border: 3px solid #2ecc71;
            border-radius: 8px;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            padding: 8px;
            gap: 3px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .dice-dot {
            background-color: #000000;
            border-radius: 50%;
            width: 100%;
            height: 100%;
            visibility: hidden;
        }

        .dice-dot.show {
            visibility: visible;
        }

        .dice-btn-text {
            font-weight: bold;
            font-size: 1.1rem;
            color: #333;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        #status-message {
            margin-top: 15px;
            padding: 10px;
            background: #eef;
            border-radius: 5px;
            text-align: center;
            font-weight: bold;
            color: #333;
            border: 1px dashed #ccc;
        }

        /* --- MODAL --- */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            width: 95%;
            max-width: 800px;
            text-align: center;
            border: 4px solid #333;
            animation: popIn 0.3s ease;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            max-height: 90vh;
        }

        @keyframes popIn {
            from {
                transform: scale(0.8);
                opacity: 0;
            }

            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .modal-content h3 {
            margin-bottom: 15px;
            font-size: 1.5rem;
            color: #2e86c1;
        }

        .modal-content p {
            margin-bottom: 20px;
            font-size: 1.2rem;
        }

        /* Layout 2 Kolom Hasil */
        .results-wrapper {
            display: flex;
            gap: 20px;
            text-align: left;
            flex: 1;
            overflow: hidden;
        }

        .results-column {
            flex: 1;
            display: flex;
            flex-direction: column;
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 10px;
            background: #fafafa;
        }

        .column-title {
            text-align: center;
            font-weight: bold;
            color: #555;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 2px solid #ddd;
            text-transform: uppercase;
            font-size: 0.9rem;
        }

        .result-list {
            margin: 0;
            overflow-y: auto;
            flex: 1;
        }

        .result-item {
            background: #f8f9fa;
            margin-bottom: 8px;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #ddd;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .result-name {
            font-weight: bold;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .result-status {
            font-size: 0.8rem;
            padding: 3px 8px;
            border-radius: 12px;
            color: white;
            font-weight: bold;
        }

        .status-winner {
            background: #f1c40f;
            color: #333;
        }

        .status-finish {
            background: #2ecc71;
        }

        .status-dead {
            background: #95a5a6;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .option-btn {
            background: #f0f0f0;
            border: 2px solid #ccc;
            padding: 15px;
            cursor: pointer;
            font-weight: bold;
            border-radius: 8px;
            transition: all 0.2s;
            font-size: 1rem;
        }

        .option-btn:hover {
            background: #e0e0e0;
            border-color: #bbb;
        }

        .option-btn.correct {
            background: #a9dfbf;
            border-color: #27ae60;
            color: #145a32;
        }

        .option-btn.wrong {
            background: #f1948a;
            border-color: #c0392b;
            color: #78281f;
        }

        .restart-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 25px;
            font-size: 1rem;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 20px;
            font-weight: bold;
        }

        .restart-btn:hover {
            background: #2980b9;
        }

        @media (max-width: 900px) {
            .token {
                width: 55px !important;
                height: 55px !important;
            }
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .main-layout {
                display: grid;
                grid-template-columns: 1fr;
                grid-template-rows: auto auto auto auto;
                gap: 10px;
            }

            .area-board { grid-column: 1; grid-row: 1; }
            .area-dice  { grid-column: 1; grid-row: 2; }
            .area-sidebar { grid-column: 1; grid-row: 3; }
            .area-footer { grid-column: 1; grid-row: 4; padding: 10px 0 20px 0; }

            .setup-title {
                font-size: 1.4rem;
            }

            .setup-instruction {
                font-size: 0.95rem;
                padding: 8px 14px;
            }

            .card-label {
                font-size: 1rem;
            }

            .card-player-num {
                font-size: 0.75rem;
                padding: 3px 8px;
            }

            .card-icon {
                font-size: 2rem;
                margin-bottom: 6px;
            }

            .white-card {
                border-width: 3px;
            }

            .card-grid {
                gap: 12px;
            }

            .finish-box {
                width: 78px;
                height: 78px;
                font-size: 0.9rem;
                border-width: 3px;
                border-radius: 8px;
            }

            /* BARIS 1: PAPAN */
            .area-board {
                grid-column: 1 / -1;
                grid-row: 1;
            }

            /* BARIS 2: DADU */
            .area-dice {
                grid-column: 1 / -1;
                grid-row: 2;
            }

            /* BARIS 3: SIDEBAR PEMAIN */
            .area-sidebar {
                grid-column: 1 / -1;
                grid-row: 3;
            }

            .board-container {
                height: auto;
            }

            .board {
                width: 100%;
            }

            .sidebar {
                height: auto;
                max-height: 400px;
                overflow-y: auto;
            }

            .modal-content {
                max-width: 95%;
                height: 90vh;
                overflow-y: auto;
            }

            .token {
                width: 47px !important;
                height: 47px !important;
                font-size: 10px;
            }

            .results-wrapper {
                flex-direction: column;
                height: 50vh;
            }

            .results-column {
                max-height: 45%;
            }
        }

        @media (max-width: 500px) {
            .token {
                width: 46px !important;
                height: 46px !important;
            }
        }

        @media (max-width: 450px) {
            .token {
                width: 35px !important;
                height: 35px !important;
            }
        }

        @media (max-width: 400px) {
            .token {
                width: 29px !important;
                height: 29px !important;
            }
        }

        @media (max-width: 380px) {
            body {
                padding: 6px;
            }

            .main-layout {
                gap: 6px;
            }

            .setup-title {
                font-size: 1.1rem;
            }

            .setup-instruction {
                font-size: 0.8rem;
                padding: 6px 10px;
            }

            .card-label {
                font-size: 0.85rem;
            }

            .card-player-num {
                font-size: 0.65rem;
                padding: 2px 6px;
            }

            .card-icon {
                font-size: 1.6rem;
                margin-bottom: 4px;
            }

            .card-grid {
                gap: 8px;
            }

            .finish-box {
                width: 48px;
                height: 48px;
                font-size: 0.7rem;
                border-width: 2px;
                border-radius: 8px;
                box-shadow: 0 0 8px rgba(255, 215, 0, 0.5);
            }

            .board {
                width: 100%;
                max-width: 320px;
                margin: 0 auto;
            }

            .token {
                width: 20px !important;
                height: 20px !important;
                font-size: 8px;
            }

            .sidebar {
                max-height: 280px;
                font-size: 0.75rem;
            }

            .dice-visual-container {
                transform: scale(0.8);
            }

            .modal-content {
                max-width: 98%;
                height: 88vh;
                padding: 10px;
                font-size: 0.8rem;
            }

            .results-wrapper {
                height: 45vh;
            }

            .results-column {
                max-height: 40%;
            }
        }
    </style>
</head>

<body>
    <div id="setup-overlay">
        <div class="setup-container">
            <h1 class="setup-title">PENENTUAN URUTAN MAIN</h1>
            <p id="setup-instruction" class="setup-instruction">Giliran Pemain 1 memilih kartu...</p>

            <div class="card-grid">
                <div class="white-card" onclick="pickCard(this)">
                    <div class="card-content">
                        <div class="card-icon">?</div>
                        <div class="card-label">PILIH</div>
                    </div>
                </div>
                <div class="white-card" onclick="pickCard(this)">
                    <div class="card-content">
                        <div class="card-icon">?</div>
                        <div class="card-label">PILIH</div>
                    </div>
                </div>
                <div class="white-card" onclick="pickCard(this)">
                    <div class="card-content">
                        <div class="card-icon">?</div>
                        <div class="card-label">PILIH</div>
                    </div>
                </div>
                <div class="white-card" onclick="pickCard(this)">
                    <div class="card-content">
                        <div class="card-icon">?</div>
                        <div class="card-label">PILIH</div>
                    </div>
                </div>
            </div>
            <div style="margin-top: 20px;">
                <img src="asset/menu button.png" class="home-btn" onclick="window.location.href='menu.html'" alt="Home Button">
            </div>
        </div>
    </div>

    <div class="main-layout" id="game-layout">

        <!-- BAGIAN 1: PAPAN PERMAINAN (KIRI) -->
        <div class="board-container area-board">
            <div class="board">
                <!-- KIRI ATAS (Coklat) -->
                <div class="zone coklat" id="zone-0">
                    <div class="box start-box" id="z0-start"><img src="image/start.png" alt="START"
                            style="width: 100%; height: 100%; object-fit: contain;">
                    </div>
                    <div class="box" id="z0-1"><img src="image/1TL.png" alt="START"
                            style="width: 100%; height: 100%; object-fit: contain;"></div>
                    <div class="box" id="z0-2" style="grid-column: 2; grid-row: 2;"><img src="image/2TL.png" alt="START"
                            style="width: 100%; height: 100%; object-fit: contain;">
                    </div>
                    <div class="box" id="z0-3" style="grid-column: 3; grid-row: 2;"><img src="image/3TL.png" alt="START"
                            style="width: 100%; height: 100%; object-fit: contain;">
                    </div>
                    <div class="box" id="z0-4" style="grid-column: 3; grid-row: 3;"><img src="image/4TL.png" alt="START"
                            style="width: 100%; height: 100%; object-fit: contain;">
                    </div>
                    <div class="box" id="z0-5" style="grid-column: 4; grid-row: 3;"><img src="image/5TL.png" alt="START"
                            style="width: 100%; height: 100%; object-fit: contain;">
                    </div>
                </div>

                <!-- KANAN ATAS (Abu) -->
                <div class="zone abu" id="zone-1">
                    <div class="box start-box" id="z1-start" style="grid-column: 4; grid-row: 1;"><img
                            src="image/start.png" alt="START" style="width: 100%; height: 100%; object-fit: contain;">
                    </div>
                    <div class="box" id="z1-1" style="grid-column: 4; grid-row: 2;"><img src="image/1APB.png" alt="START"
                            style="width: 100%; height: 100%; object-fit: contain;">
                    </div>
                    <div class="box" id="z1-2" style="grid-column: 3; grid-row: 2;"><img src="image/2APB.png" alt="START"
                            style="width: 100%; height: 100%; object-fit: contain;">
                    </div>
                    <div class="box" id="z1-3" style="grid-column: 3; grid-row: 3;"><img src="image/3APB.png" alt="START"
                            style="width: 100%; height: 100%; object-fit: contain;">
                    </div>
                    <div class="box" id="z1-4" style="grid-column: 2; grid-row: 3;"><img src="image/4APB.png" alt="START"
                            style="width: 100%; height: 100%; object-fit: contain;">
                    </div>
                    <div class="box" id="z1-5" style="grid-column: 2; grid-row: 4;"><img src="image/5APB.png" alt="START"
                            style="width: 100%; height: 100%; object-fit: contain;">
                    </div>
                </div>

                <!-- KIRI BAWAH (Merah) -->
                <div class="zone merah" id="zone-2">
                    <div class="box" id="z2-5" style="grid-column: 3; grid-row: 1;"><img src="image/5K.png" alt="START"
                            style="width: 100%; height: 100%; object-fit: contain;">
                    </div>
                    <div class="box" id="z2-4" style="grid-column: 3; grid-row: 2;"><img src="image/4K.png" alt="START"
                            style="width: 100%; height: 100%; object-fit: contain;">
                    </div>
                    <div class="box" id="z2-3" style="grid-column: 2; grid-row: 2;"><img src="image/3K.png" alt="START"
                            style="width: 100%; height: 100%; object-fit: contain;">
                    </div>
                    <div class="box" id="z2-2" style="grid-column: 2; grid-row: 3;"><img src="image/2K.png" alt="START"
                            style="width: 100%; height: 100%; object-fit: contain;">
                    </div>
                    <div class="box" id="z2-1" style="grid-column: 1; grid-row: 3;"><img src="image/1K.png" alt="START"
                            style="width: 100%; height: 100%; object-fit: contain;">
                    </div>
                    <div class="box start-box" id="z2-start" style="grid-column: 1; grid-row: 4;"><img
                            src="image/start.png" alt="START" style="width: 100%; height: 100%; object-fit: contain;">
                    </div>
                </div>

                <!-- KANAN BAWAH (Biru) -->
                <div class="zone biru" id="zone-3">
                    <div class="box" id="z3-5" style="grid-column:1; grid-row: 2;"><img src="image/5B.png" alt="START"
                            style="width: 100%; height: 100%; object-fit: contain;">
                    </div>
                    <div class="box" id="z3-4" style="grid-column: 2; grid-row: 2;"><img src="image/4B.png" alt="START"
                            style="width: 100%; height: 100%; object-fit: contain;">
                    </div>
                    <div class="box" id="z3-3" style="grid-column: 2; grid-row: 3;"><img src="image/3B.png" alt="START"
                            style="width: 100%; height: 100%; object-fit: contain;">
                    </div>
                    <div class="box" id="z3-2" style="grid-column: 3; grid-row: 3;"><img src="image/2B.png" alt="START"
                            style="width: 100%; height: 100%; object-fit: contain;">
                    </div>
                    <div class="box" id="z3-1" style="grid-column: 3; grid-row: 4;"><img src="image/1B.png" alt="START"
                            style="width: 100%; height: 100%; object-fit: contain;">
                    </div>
                    <div class="box start-box" id="z3-start" style="grid-column: 4; grid-row: 4;"><img
                            src="image/start.png" alt="START" style="width: 100%; height: 100%; object-fit: contain;">
                    </div>
                </div>

                <div class="finish-box" id="finish-zone"><img src="image/finish.png" alt="FINIS"
                        style="width: 100%; height: 100%; object-fit: contain;"></div>
            </div>
        </div>

        <!-- BAGIAN 2: SIDEBAR PEMAIN (KANAN) -->
        <div class="sidebar area-sidebar">
            <div class="panel-title">DAFTAR PEMAIN</div>
            <ul class="player-list" id="player-list-container">
            </ul>
            <div id="status-message">Siap bermain!</div>
        </div>

        <!-- BAGIAN 3: TOMBOL DADU (BAWAH TENGAH) -->
        <div class="dice-section area-dice">
            <button id="dice-btn" class="dice-btn-large" onclick="rollDice()">
                <div class="dice-visual-container" id="dice-visual">
                    <div class="dice-dot" id="d1"></div>
                    <div class="dice-dot" id="d2"></div>
                    <div class="dice-dot" id="d3"></div>
                    <div class="dice-dot" id="d4"></div>
                    <div class="dice-dot" id="d5"></div>
                    <div class="dice-dot" id="d6"></div>
                    <div class="dice-dot" id="d7"></div>
                    <div class="dice-dot" id="d8"></div>
                    <div class="dice-dot" id="d9"></div>
                </div>
                <div class="dice-btn-text">Klik untuk lempar!</div>
            </button>
        </div>

        <!-- BAGIAN 4: FOOTER / TOMBOL HOME (GRID PALING BAWAH) -->
        <div class="area-footer">
            <img src="asset/menu button.png" class="home-btn" onclick="window.location.href='menu.html'" alt="Home Button">
        </div>

    </div>


    <!-- MODAL PERTANYAAN -->
    <div class="modal-overlay" id="question-modal">
        <div class="modal-content" style="max-width: 450px;">
            <h3 id="q-title">Pertanyaan!</h3>
            <p id="q-text">Soal Kuis</p>
            <div class="options-grid" id="q-options">
                <button class="option-btn" onclick="checkAnswer(0)">A</button>
                <button class="option-btn" onclick="checkAnswer(1)">B</button>
                <button class="option-btn" onclick="checkAnswer(2)">C</button>
                <button class="option-btn" onclick="checkAnswer(3)">D</button>
            </div>
            <p id="q-feedback" style="margin-top:15px; font-size:1rem; font-weight:bold; min-height: 1.2em;"></p>
        </div>
    </div>

    <!-- MODAL GAME OVER / HASIL AKHIR -->
    <div class="modal-overlay" id="gameover-modal">
        <div class="modal-content">
            <h3 style="color: #2e86c1; margin-bottom: 10px;">PERMAINAN SELESAI!</h3>
            <p>Klasemen Akhir Pemain:</p>

            <div class="results-wrapper">
                <!-- KOLOM KIRI: URUTAN TIBA -->
                <div class="results-column">
                    <div class="column-title">Juara Urutan Tiba</div>
                    <div id="results-order-list" class="result-list">
                    </div>
                </div>

                <!-- KOLOM KANAN: TERBANYAK HP -->
                <div class="results-column">
                    <div class="column-title">Juara Terbanyak HP</div>
                    <div id="results-hp-list" class="result-list">
                    </div>
                </div>
            </div>

            <button class="restart-btn" onclick="window.location.href='menu.html'">MAIN LAGI</button>
        </div>
    </div>

    <script>

        // 1. PEMAIN MERAH: Kebakaran Hutan dan Lahan
        const poolMerah = [
            { q: "Saat melihat api kecil di lahan kering dekat rumah, kamu sebaiknya …", opts: ["Meniup api agar padam sendiri", "Mendekat untuk melihat lebih jelas", "Melapor kepada orang dewasa", "Mengambil kayu untuk menjauhkan api"], ans: 2 },
            { q: "Asap kebakaran hutan membuat pandangan terganggu. Yang sebaiknya kamu lakukan adalah …", opts: ["Tetap bermain di luar", "Menggunakan penutup hidung dan masuk rumah", "Berlari ke arah asap", "Mengambil foto asap"], ans: 1 },
            { q: "Mengapa rumput kering mudah terbakar?", opts: ["Karena warnanya cokelat", "Karena terkena angin", "Karena kondisinya kering", "Karena tumbuh di tanah"], ans: 2 },
            { q: "Saat terjadi kebakaran hutan, kamu harus menjauhi lokasi karena …", opts: ["Banyak orang berkumpul", "Api bisa menyebar dengan cepat", "Tanah menjadi kotor", "Hewan hutan keluar"], ans: 1 },
            { q: "Jika teman bermain korek api di dekat semak kering, kamu harus …", opts: ["Ikut menyalakan api", "Membiarkannya", "Mengingatkan dan melapor", "Menertawakannya"], ans: 2 },
            { q: "Udara berasap tebal bisa menyebabkan …", opts: ["Rasa lapar", "Gangguan pernapasan", "Haus berlebihan", "Mata menjadi tajam"], ans: 1 },
            { q: "Saat diminta orang dewasa mengungsi karena asap kebakaran, kamu harus …", opts: ["Menolak pergi", "Pergi dengan tertib mengikuti arahan", "Menunggu teman dulu", "Tetap bermain"], ans: 1 },
            { q: "Mengapa tidak boleh membakar sampah sembarangan saat musim kemarau?", opts: ["Asapnya bau", "Api bisa menyebar ke lahan sekitar", "Dilihat tetangga", "Membuat tanah panas"], ans: 1 },
            { q: "Saat melihat hutan terbakar dari jauh, tindakan aman adalah …", opts: ["Mendekat untuk menonton", "Tetap di tempat aman dan melapor", "Berlari ke arah api", "Mengajak teman melihat"], ans: 1 },
            { q: "Jika mata terasa perih karena asap, sebaiknya …", opts: ["Mengucek mata", "Tetap di luar rumah", "Masuk ruangan tertutup", "Bermain air di luar"], ans: 2 },
            { q: "Kebakaran hutan dapat merusak …", opts: ["Jalan raya saja", "Lingkungan dan udara", "Gedung sekolah saja", "Mainan anak"], ans: 1 },
            { q: "Saat melihat api membesar karena angin, kamu harus …", opts: ["Merekam video", "Mendekat pelan-pelan", "Segera menjauh", "Menunggu api padam"], ans: 2 },
            { q: "Orang yang sebaiknya dihubungi saat melihat kebakaran adalah …", opts: ["Teman sebaya", "Orang dewasa", "Anak kecil", "Saudara jauh"], ans: 1 },
            { q: "Saat evakuasi karena kebakaran, kamu sebaiknya membawa …", opts: ["Semua mainan", "Barang secukupnya sesuai arahan", "Sepeda", "Televisi"], ans: 1 },
            { q: "Setelah kebakaran, kita tetap harus berhati-hati karena …", opts: ["Tanah menjadi bersih", "Bisa ada api kecil tersisa", "Udara langsung segar", "Hutan jadi sepi"], ans: 1 }
        ];

        // 2. PEMAIN BIRU: Banjir
        const poolBiru = [
            { q: "Hujan deras membuat air naik di jalan. Kamu sebaiknya …", opts: ["Bermain air", "Berjalan di tengah genangan", "Tetap di tempat aman", "Berenang kecil"], ans: 2 },
            { q: "Mengapa air banjir berbahaya untuk dimainkan?", opts: ["Warnanya keruh", "Membawa benda kotor dan berbahaya", "Terasanya dingin", "Banyak ikan"], ans: 1 },
            { q: "Saat diminta mengungsi, kamu harus menuju …", opts: ["Tempat rendah", "Tempat tinggi dan aman", "Sungai", "Sawah"], ans: 1 },
            { q: "Melihat selokan penuh sampah sebaiknya …", opts: ["Dibiarkan saja", "Dibersihkan bersama orang dewasa", "Ditutup tanah", "Diberi batu"], ans: 1 },
            { q: "Air banjir masuk rumah, tindakan tepat adalah …", opts: ["Tetap tidur", "Mengikuti arahan orang dewasa", "Bermain perahu kertas", "Membuka semua pintu"], ans: 1 },
            { q: "Mengapa listrik harus dihindari saat banjir?", opts: ["Karena mahal", "Bisa menyebabkan bahaya", "Lampu jadi redup", "Air jadi panas"], ans: 1 },
            { q: "Teman mengajak bermain air banjir, kamu harus …", opts: ["Ikut sebentar", "Menolak dengan baik", "Bermain di tepi", "Lompat-lompat"], ans: 1 },
            { q: "Setelah banjir surut, kita perlu …", opts: ["Bermain lumpur", "Membersihkan rumah", "Mengumpulkan air", "Menutup jendela"], ans: 1 },
            { q: "Banjir sering terjadi karena …", opts: ["Banyak pohon", "Sampah menyumbat saluran air", "Udara panas", "Jalan sempit"], ans: 1 },
            { q: "Saat banjir, sepatu yang tepat digunakan adalah …", opts: ["Sandal tipis", "Tanpa alas kaki", "Alas kaki yang aman", "Sepatu roda"], ans: 2 },
            { q: "Air terus naik, kamu harus …", opts: ["Tetap duduk", "Naik ke tempat lebih tinggi", "Tidur saja", "Bermain air"], ans: 1 },
            { q: "Banjir dapat membuat lingkungan menjadi …", opts: ["Lebih bersih", "Tidak aman", "Lebih indah", "Lebih kering"], ans: 1 },
            { q: "Mengapa kita tidak boleh menyentuh air banjir terlalu lama?", opts: ["Airnya asin", "Bisa membawa kuman", "Terlalu dingin", "Terlalu hangat"], ans: 1 },
            { q: "Saat di sekolah terjadi banjir, kamu harus …", opts: ["Pulang sendiri", "Mengikuti arahan guru", "Sembunyi di kelas", "Bermain di lapangan"], ans: 1 },
            { q: "Kerja sama setelah banjir penting agar …", opts: ["Cepat selesai", "Lingkungan bersih dan sehat", "Bisa bermain lagi", "Rumah jadi baru"], ans: 1 }
        ];

        // 3. PEMAIN ABU-ABU: Angin Puting Beliung
        const poolAbu = [
            { q: "Angin sangat kencang, kamu sebaiknya …", opts: ["Bermain layang-layang", "Masuk rumah", "Berdiri di jalan", "Naik sepeda"], ans: 1 },
            { q: "Benda yang perlu dijauhi saat angin kencang adalah …", opts: ["Kursi kayu", "Pohon besar", "Buku", "Sepatu"], ans: 1 },
            { q: "Mengapa jendela perlu ditutup saat angin kencang?", opts: ["Agar gelap", "Agar debu tidak masuk dan kaca tidak pecah", "Supaya sunyi", "Agar tidak dingin"], ans: 1 },
            { q: "Saat di luar rumah dan angin tiba-tiba kencang, kamu harus …", opts: ["Berlari tanpa arah", "Mencari bangunan kokoh", "Duduk di jalan", "Memanjat pohon"], ans: 1 },
            { q: "Angin puting beliung dapat membuat benda …", opts: ["Menghilang", "Beterbangan", "Membeku", "Mengecil"], ans: 1 },
            { q: "Setelah angin berhenti, sebelum keluar kamu perlu …", opts: ["Langsung bermain", "Memastikan situasi aman", "Memanggil teman", "Membuka semua pintu"], ans: 1 },
            { q: "Mengapa harus menjauhi tiang listrik?", opts: ["Warnanya gelap", "Bisa roboh dan berbahaya", "Terlalu tinggi", "Terbuat dari besi"], ans: 1 },
            { q: "Saat berada di sekolah dan angin kencang, kamu harus …", opts: ["Pulang sendiri", "Mengikuti arahan guru", "Bermain di halaman", "Sembunyi di toilet luar"], ans: 1 },
            { q: "Atap rumah bisa rusak karena …", opts: ["Hujan biasa", "Angin sangat kencang", "Matahari panas", "Malam hari"], ans: 1 },
            { q: "Jika melihat banyak benda beterbangan, kamu harus …", opts: ["Menangkapnya", "Menjauh dan berlindung", "Menonton", "Berjalan pelan"], ans: 1 },
            { q: "Tempat paling aman saat angin kencang adalah …", opts: ["Lapangan terbuka", "Dalam bangunan kokoh", "Bawah pohon", "Pinggir jalan"], ans: 1 },
            { q: "Mengapa tidak boleh berdiri dekat pohon besar?", opts: ["Banyak semut", "Pohon bisa tumbang", "Daunnya rontok", "Batangnya kasar"], ans: 1 },
            { q: "Saat angin kencang, pintu rumah sebaiknya …", opts: ["Dibuka lebar", "Ditutup rapat", "Dibiarkan saja", "Dilepas"], ans: 1 },
            { q: "Angin puting beliung biasanya datang saat …", opts: ["Cuaca cerah", "Perubahan cuaca mendadak", "Malam sunyi", "Musim kemarau panjang"], ans: 1 },
            { q: "Setelah keadaan aman, kamu boleh keluar rumah dengan …", opts: ["Berlari cepat", "Hati-hati dan melihat sekitar", "Mata tertutup", "Melompat-lompat"], ans: 1 }
        ];

        // 4. PEMAIN COKLAT: Tanah Longsor
        const poolCoklat = [
            { q: "Tanah longsor terjadi ketika tanah bergerak dari …", opts: ["Tempat rendah ke tinggi", "Tempat tinggi ke rendah", "Datar ke datar", "Sungai ke laut"], ans: 1 },
            { q: "Hujan deras di daerah lereng bisa menyebabkan …", opts: ["Tanah mengeras", "Tanah longsor", "Tanah kering", "Tanah berdebu"], ans: 1 },
            { q: "Jika melihat retakan di tanah lereng, kamu harus …", opts: ["Bermain di dekatnya", "Melapor pada orang dewasa", "Duduk di atasnya", "Menggali tanah"], ans: 1 },
            { q: "Saat terjadi longsor, kamu harus …", opts: ["Mendekat melihat", "Menjauh dari lokasi", "Mengambil batu", "Berdiri diam"], ans: 1 },
            { q: "Mengapa daerah lereng berisiko longsor?", opts: ["Banyak rumput", "Tanahnya miring", "Udara dingin", "Banyak rumah"], ans: 1 },
            { q: "Tanda awal longsor bisa berupa …", opts: ["Tanah retak", "Tanah berwarna cerah", "Rumput tumbuh", "Tanah kering"], ans: 0 },
            { q: "Jika diminta mengungsi karena potensi longsor, kamu harus …", opts: ["Tetap di rumah", "Mengikuti arahan orang dewasa", "Bermain dulu", "Mengajak teman melihat"], ans: 1 },
            { q: "Longsor dapat menimbun …", opts: ["Awan", "Rumah dan jalan", "Sungai", "Angin"], ans: 1 },
            { q: "Setelah longsor, tanah di sekitar masih bisa …", opts: ["Aman selalu", "Bergerak lagi", "Mengering cepat", "Menjadi keras"], ans: 1 },
            { q: "Mengapa tidak boleh mendekati area longsor?", opts: ["Banyak lumpur", "Berbahaya dan tidak stabil", "Sulit difoto", "Bau tanah"], ans: 1 },
            { q: "Saat tinggal di daerah lereng, kita harus …", opts: ["Tidak peduli", "Waspada saat hujan deras", "Bermain di lereng", "Menebang semua pohon"], ans: 1 },
            { q: "Akar pohon membantu mencegah longsor karena …", opts: ["Membuat tanah licin", "Mengikat tanah", "Menyerap udara", "Membuat tanah panas"], ans: 1 },
            { q: "Jika terdengar suara gemuruh dari lereng saat hujan, kamu harus …", opts: ["Mencari sumber suara", "Menjauh dan melapor", "Bersembunyi di bawah pohon", "Duduk diam"], ans: 1 },
            { q: "Longsor sering terjadi di daerah …", opts: ["Pantai datar", "Pegunungan atau perbukitan", "Lapangan luas", "Kota besar"], ans: 1 },
            { q: "Setelah kondisi aman, kembali ke rumah harus …", opts: ["Sendiri", "Dengan izin dan arahan orang dewasa", "Berlari cepat", "Diam-diam"], ans: 1 }
        ];

        // Database Warna
        const colorDatabase = [
            { name: 'Tanah Longsor', hex: '#e0c090', real: '#8B5A2B' },
            { name: 'Puting Beliung', hex: '#d3d3d3', real: '#7f8c8d' },
            { name: 'Kebakaran', hex: '#ff9999', real: '#C0392B' },
            { name: 'Banjir', hex: '#99ccff', real: '#3498DB' }
        ];

        // Database Pion
        const pionDatabase = {
            'Kebakaran': 'image/pionK.png',
            'Banjir': 'image/pionB.png',
            'Tanah Longsor': 'image/pionTL.png',
            'Puting Beliung': 'image/pionAPB.png'
        };

        //Database BackGround
        const bgDatabase = {
            'Tanah Longsor': 'image/tl.png',
            'Puting Beliung': 'image/apb.png',
            'Kebakaran': 'image/k.png',
            'Banjir': 'image/b.png'
        };

        // --- VARIABEL PELACAKAN PERTANYAAN  ---
        let usedQuestions = {
            'Kebakaran': new Set(),
            'Banjir': new Set(),
            'Puting Beliung': new Set(),
            'Tanah Longsor': new Set()
        };

        // Mengacak Warna
        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        let shuffledColors = shuffle([...colorDatabase]);
        let setupStep = 0;
        const setupInstruction = document.getElementById('setup-instruction');
        const setupOverlay = document.getElementById('setup-overlay');
        const gameLayout = document.getElementById('game-layout');

        function pickCard(cardElement) {
            if (cardElement.classList.contains('picked') || setupStep >= 4) return;

            const assignedColor = shuffledColors[setupStep];
            const playerNum = setupStep + 1;

            // 1. Update Visual Kartu
            cardElement.classList.add('picked');
            cardElement.style.backgroundColor = assignedColor.hex;
            cardElement.style.borderColor = assignedColor.real;
            cardElement.innerHTML = `
                <div class="card-content">
                    <div class="card-label" style="color: ${assignedColor.real}">${assignedColor.name}</div>
                    <div class="card-player-num">Pemain ${playerNum}</div>
                </div>
            `;

            // 2. Update Data Pemain
            players[setupStep].name = `Pemain ${playerNum} (${assignedColor.name})`;
            players[setupStep].category = assignedColor.name;

            // --- UPDATE VISUAL PION ---
            const token = document.getElementById(`token-${setupStep}`);
            const pionImg = pionDatabase[assignedColor.name];

            if (token && pionImg) {
                token.style.backgroundImage = `url(${pionImg})`;
                token.style.backgroundRepeat = 'no-repeat';
                token.style.backgroundSize = 'contain';
                token.style.backgroundPosition = 'center';
            }

            players[setupStep].color = assignedColor.hex;
            players[setupStep].realColor = assignedColor.real;

            // 3. Update Tampilan Zona Papan (Agar sesuai warna pemain)
            const zoneEl = document.getElementById(`zone-${setupStep}`);
            if (zoneEl) {
                zoneEl.style.backgroundColor = assignedColor.hex;
                const bgImg = bgDatabase[assignedColor.name];
                if (bgImg) {
                    zoneEl.style.backgroundImage = `url('${bgImg}')`;
                }
            }

            //Database img sub kotak bencana
            const imageCodeMap = {
                'Tanah Longsor': 'TL',
                'Puting Beliung': 'APB',
                'Kebakaran': 'K',
                'Banjir': 'B'
            };

            const code = imageCodeMap[assignedColor.name];
            for (let i = 1; i <= 5; i++) {
                const boxId = `z${setupStep}-${i}`;
                const imgElement = document.querySelector(`#${boxId} img`);
                if (imgElement) {
                    imgElement.src = `image/${i}${code}.png`;
                }
            }

            setupStep++;

            // Lanjut atau Selesai
            if (setupStep < 4) {
                setupInstruction.innerText = `Giliran Pemain ${setupStep + 1} memilih kartu...`;
                setupInstruction.style.borderColor = "#ccc";
                setupInstruction.style.color = "#555";
            } else {
                setupInstruction.innerText = "Semua pemain siap! Memulai permainan...";
                setTimeout(startGame, 1500);
            }

            renderSidebar()
        }

        function startGame() {
            setupOverlay.classList.add('hidden');
            const gameLayout = document.getElementById('game-layout');
            if (gameLayout) {
                gameLayout.classList.add('visible');
            }
            document.body.style.overflow = "auto";
        }

        const players = [
            { id: 0, name: "Pemain 1 (Tanah Longsor)", color: "#e0c090", realColor: "#8B5A2B", pos: 0, health: 100, isDead: false, isFinished: false, previousTurnRoll: 0, currentTurnRoll: 0, failedStartAttempts: 0, finishOrder: null },
            { id: 1, name: "Pemain 2 (Puting Beliung)", color: "#d3d3d3", realColor: "#7f8c8d", pos: 0, health: 100, isDead: false, isFinished: false, previousTurnRoll: 0, currentTurnRoll: 0, failedStartAttempts: 0, finishOrder: null },
            { id: 2, name: "Pemain 3 (Kebakaran)", color: "#ff9999", realColor: "#C0392B", pos: 0, health: 100, isDead: false, isFinished: false, previousTurnRoll: 0, currentTurnRoll: 0, failedStartAttempts: 0, finishOrder: null },
            { id: 3, name: "Pemain 4 (Banjir)", color: "#99ccff", realColor: "#3498DB", pos: 0, health: 100, isDead: false, isFinished: false, previousTurnRoll: 0, currentTurnRoll: 0, failedStartAttempts: 0, finishOrder: null }
        ];

        let currentPlayerIdx = 0;
        let currentDiceValue = 0;
        let questionsRemaining = 0;
        let globalFinishCounter = 0;

        const diceBtn = document.getElementById('dice-btn');
        const statusMessage = document.getElementById('status-message');
        const playerListContainer = document.getElementById('player-list-container');

        const modal = document.getElementById('question-modal');
        const qTitle = document.getElementById('q-title');
        const qText = document.getElementById('q-text');
        const qFeedback = document.getElementById('q-feedback');
        const qOpts = document.getElementById('q-options');
        const boardEl = document.querySelector('.board');

        const gameOverModal = document.getElementById('gameover-modal');
        const resultsOrderContainer = document.getElementById('results-order-list');
        const resultsHPContainer = document.getElementById('results-hp-list');

        function initTokens() {
            const boardEl = document.querySelector('.board');

            players.forEach(p => {
                const token = document.createElement('div');
                token.className = 'token';
                token.id = `token-${p.id}`;
                token.style.backgroundColor = 'transparent';
                boardEl.appendChild(token);
                updateTokenPosition(p.id);
            });
            renderSidebar();
            setDiceFace(6);
        }

        function setDiceFace(number) {
            for (let i = 1; i <= 9; i++) {
                document.getElementById(`d${i}`).classList.remove('show');
            }
            switch (number) {
                case 1: document.getElementById('d5').classList.add('show'); break;
                case 2:
                    document.getElementById('d1').classList.add('show');
                    document.getElementById('d9').classList.add('show');
                    break;
                case 3:
                    document.getElementById('d1').classList.add('show');
                    document.getElementById('d5').classList.add('show');
                    document.getElementById('d9').classList.add('show');
                    break;
                case 4:
                    document.getElementById('d1').classList.add('show');
                    document.getElementById('d3').classList.add('show');
                    document.getElementById('d7').classList.add('show');
                    document.getElementById('d9').classList.add('show');
                    break;
                case 5:
                    document.getElementById('d1').classList.add('show');
                    document.getElementById('d3').classList.add('show');
                    document.getElementById('d5').classList.add('show');
                    document.getElementById('d7').classList.add('show');
                    document.getElementById('d9').classList.add('show');
                    break;
                case 6:
                    document.getElementById('d1').classList.add('show');
                    document.getElementById('d4').classList.add('show');
                    document.getElementById('d7').classList.add('show');
                    document.getElementById('d3').classList.add('show');
                    document.getElementById('d6').classList.add('show');
                    document.getElementById('d9').classList.add('show');
                    break;
            }
        }

        function renderSidebar() {
            playerListContainer.innerHTML = '';

            players.forEach((p, index) => {
                const li = document.createElement('li');
                li.className = `player-card ${index === currentPlayerIdx ? 'active' : ''}`;

                let hpColor = '#27ae60';
                let hpText = 'Sehat';
                if (p.health <= 0) { hpColor = '#7f8c8d'; hpText = 'Mati'; }
                else if (p.health <= 40) { hpColor = '#c0392b'; hpText = 'Kritis'; }

                const avatarImg = pionDatabase[p.category];

                li.innerHTML = `
                    <div class="player-avatar" style="
                        background-image: url('${avatarImg}');
                        background-size: contain;
                        background-repeat: no-repeat;
                        background-position: center;
                        background-color: ${p.realColor}; /* Warna cadangan jika gambar error */
                    "></div>

                    <div class="player-info">
                        <div class="player-name">${p.name}</div>
                        <div class="player-status">
                            HP: <span style="font-weight:bold; color:${hpColor}">${p.health}%</span>
                            ${p.isFinished ? '✅ FINIS' : ''}
                            ${p.isDead ? '☠️ RIP' : ''}
                        </div>
                    </div>
                    ${index === currentPlayerIdx ? '<div style="font-weight:bold; color:#27ae60;">▶</div>' : ''}
                `;
                playerListContainer.appendChild(li);
            });
        }

        function updateTokenPosition(playerId) {
            const p = players[playerId];
            const token = document.getElementById(`token-${playerId}`);
            const boardEl = document.querySelector('.board');
            if (!token || !boardEl) return;

            // --- LOGIKA ZONA FINIS ---
            if (p.pos > 5 || p.isFinished) {
                const finishRect = document.getElementById('finish-zone').getBoundingClientRect();
                const boardRect = boardEl.getBoundingClientRect();

                // Pusat Finish
                const centerX = (finishRect.left - boardRect.left) + (finishRect.width / 2);
                const centerY = (finishRect.top - boardRect.top) + (finishRect.height / 2);

                // Posisi token (dikurangi setengah ukuran token agar di tengah)
                const finalLeft = centerX - (token.offsetWidth / 2);
                const finalTop = centerY - (token.offsetHeight / 2);

                // Sebar posisi sedikit agar pion tidak menumpuk sempurna
                let offsetX = 0;
                let offsetY = 0;

                // Jarak penyebaran pixel
                const spread = 10;

                if (p.id === 0) { offsetX = -spread; offsetY = -spread; }
                if (p.id === 1) { offsetX = spread; offsetY = -spread; }
                if (p.id === 2) { offsetX = -spread; offsetY = spread; }
                if (p.id === 3) { offsetX = spread; offsetY = spread; }

                token.style.left = (finalLeft + offsetX) + 'px';
                token.style.top = (finalTop + offsetY) + 'px';
                return;
            }

            // --- LOGIKA KOTAK NORMAL & START ---
            let targetId = '';
            if (p.pos === 0) targetId = `z${p.id}-start`;
            else targetId = `z${p.id}-${p.pos}`;

            const targetEl = document.getElementById(targetId);

            if (targetEl) {
                const rect = targetEl.getBoundingClientRect();
                const boardRect = boardEl.getBoundingClientRect();
                const top = (rect.top - boardRect.top) + (rect.height / 2) - (token.offsetHeight / 2);
                const left = (rect.left - boardRect.left) + (rect.width / 2) - (token.offsetWidth / 2);

                token.style.top = top + 'px';
                token.style.left = left + 'px';
            }
        }

        function rollDice() {
            const p = players[currentPlayerIdx];

            if (p.health <= 0) {
                statusMessage.innerText = `${p.name} telah MATI. Lewati giliran.`;
                setTimeout(nextTurn, 1500);
                return;
            }

            if (p.isFinished) {
                statusMessage.innerText = `${p.name} telah FINIS. Menunggu pemain lain...`;
                setTimeout(nextTurn, 1500);
                return;
            }

            diceBtn.disabled = true;
            statusMessage.innerText = "Melempar dadu...";

            let shakeCount = 0;
            const shakeInterval = setInterval(() => {
                setDiceFace(Math.floor(Math.random() * 6) + 1);
                shakeCount++;
                if (shakeCount > 8) {
                    clearInterval(shakeInterval);
                    finalizeRoll();
                }
            }, 100);

            function finalizeRoll() {
                setTimeout(() => {
                    if (p.pos === 0) {
                        if (p.failedStartAttempts >= 2) {
                            currentDiceValue = 6;
                            statusMessage.innerText = `${p.name} dapat angka 6 (Bantuan!)`;
                        } else {
                            currentDiceValue = Math.floor(Math.random() * 6) + 1;
                            statusMessage.innerText = `${p.name} dapat angka ${currentDiceValue}`;
                        }
                    } else {
                        currentDiceValue = Math.floor(Math.random() * 6) + 1;
                        statusMessage.innerText = `${p.name} dapat angka ${currentDiceValue}`;
                    }

                    setDiceFace(currentDiceValue);
                    handleDiceResult(currentDiceValue);
                }, 200);
            }
        }

        function handleDiceResult(val) {
            const p = players[currentPlayerIdx];
            p.currentTurnRoll = val;
            let prevRoll = p.previousTurnRoll || 0;

            if (p.pos === 0) {
                if (val === 6) {
                    p.failedStartAttempts = 0;
                    p.pos = 1;
                    updateTokenPosition(p.id);
                    statusMessage.innerText = `${p.name} berhasil keluar! (Ke kotak 1)`;
                    setTimeout(nextTurn, 1500);
                } else {
                    p.failedStartAttempts++;
                    statusMessage.innerText = `Gagal dapat 6 (${p.failedStartAttempts}/3)`;
                    renderSidebar();
                    setTimeout(nextTurn, 1500);
                }
                return;
            }

            if (val === 5) {
                statusMessage.innerText = "Dadul 5: Diam di tempat.";
                setTimeout(nextTurn, 1500);
                return;
            }

            if (val === 6 && prevRoll === 6) {
                questionsRemaining = 2;
                statusMessage.innerText = "6 KEDUA! Bonus: Jawab 2 Pertanyaan.";
                showQuestion();
            } else {
                questionsRemaining = 1;
                showQuestion();
            }
        }

        function showQuestion() {
            const p = players[currentPlayerIdx];
            const category = p.category;

            // Tentukan pool pertanyaan dan tracking set berdasarkan kategori
            let pool;
            let usedSet;

            if (category === 'Kebakaran') {
                pool = poolMerah;
                usedSet = usedQuestions['Kebakaran'];
            } else if (category === 'Banjir') {
                pool = poolBiru;
                usedSet = usedQuestions['Banjir'];
            } else if (category === 'Puting Beliung') {
                pool = poolAbu;
                usedSet = usedQuestions['Puting Beliung'];
            } else if (category === 'Tanah Longsor') {
                pool = poolCoklat;
                usedSet = usedQuestions['Tanah Longsor'];
            } else {
                pool = poolMerah;
                usedSet = usedQuestions['Kebakaran'];
            }

            let availableIndices = [];
            for (let i = 0; i < pool.length; i++) {
                if (!usedSet.has(i)) {
                    availableIndices.push(i);
                }
            }

            if (availableIndices.length === 0) {
                console.log("Semua pertanyaan habis, mereset...");
                usedSet.clear();
                for (let i = 0; i < pool.length; i++) availableIndices.push(i);
            }

            const randomIndex = availableIndices[Math.floor(Math.random() * availableIndices.length)];
            usedSet.add(randomIndex);
            const rndQ = pool[randomIndex];

            qText.innerText = rndQ.q;
            qFeedback.innerText = "";

            if (questionsRemaining === 2) {
                qTitle.innerText = `PERTANYAAN BONUS (1/2) - ${category}`;
                qTitle.style.color = "#d35400";
            } else {
                qTitle.innerText = `Soal: ${category}`;
                qTitle.style.color = "#333";
            }

            const btns = qOpts.querySelectorAll('button');
            btns.forEach((btn, idx) => {
                btn.innerText = rndQ.opts[idx];
                btn.className = 'option-btn';
                btn.disabled = false;
                btn.onclick = () => checkAnswer(idx, rndQ.ans);
            });

            modal.style.display = 'flex';
        }

        function checkAnswer(selectedIdx, correctIdx) {
            const p = players[currentPlayerIdx];
            const btns = qOpts.querySelectorAll('button');

            btns.forEach(btn => btn.disabled = true);

            if (selectedIdx === correctIdx) {
                btns[selectedIdx].classList.add('correct');
                qFeedback.innerText = "BENAR! Maju 1 langkah.";
                qFeedback.style.color = "green";

                setTimeout(() => {
                    p.pos += 1;
                    updateTokenPosition(p.id);
                    modal.style.display = 'none';
                    renderSidebar();

                    if (p.pos > 5) {
                        p.isFinished = true;
                        if (p.finishOrder === null) {
                            globalFinishCounter++;
                            p.finishOrder = globalFinishCounter;
                        }
                        statusMessage.innerText = `${p.name} SAMPAI FINIS!`;
                        renderSidebar();
                        setTimeout(() => {
                            checkGameOver();
                        }, 1000);
                    } else {
                        questionsRemaining--;

                        if (questionsRemaining > 0) {
                            setTimeout(() => {
                                const topic = (p.category === 'Merah' ? "Kebakaran Hutan" :
                                    p.category === 'Biru' ? "Banjir" :
                                        p.category === 'Abu' ? "Angin Puting Beliung" : "Tanah Longsor");
                                qTitle.innerText = `PERTANYAAN BONUS (2/2) - ${topic}`;
                                showQuestion();
                            }, 1000);
                        } else {
                            setTimeout(nextTurn, 500);
                        }
                    }

                }, 1000);
            }

            else {
                btns[selectedIdx].classList.add('wrong');
                btns[correctIdx].classList.add('correct');

                qFeedback.innerText = "SALAH! Terjadi Bencana! HP -20.";
                qFeedback.style.color = "red";

                p.health -= 20;
                renderSidebar();

                questionsRemaining = 0;

                if (p.health <= 0) {
                    p.health = 0;
                    p.isDead = true;
                    const token = document.getElementById(`token-${p.id}`);
                    if (token) token.classList.add('token-dead');
                    renderSidebar();

                    setTimeout(() => {
                        modal.style.display = 'none';
                        statusMessage.innerText = `💀 ${p.name} GAGAL DALAM MISI! (Mati)`;
                        statusMessage.style.backgroundColor = "#fadbd8";
                        statusMessage.style.color = "#c0392b";

                        setTimeout(() => {
                            statusMessage.style.backgroundColor = "#eef";
                            statusMessage.style.color = "#333";
                            checkGameOver();
                        }, 2000);
                    }, 1500);
                    return;
                }

                setTimeout(() => {
                    modal.style.display = 'none';
                    statusMessage.innerText = `${p.name} tetap di tempat (Terkena Bencana!).`;
                    setTimeout(nextTurn, 1500);
                }, 1500);
            }
        }

        function checkGameOver() {
            const allDone = players.every(p => p.isFinished || p.isDead);

            if (allDone) {
                showFinalResults();
            } else {
                nextTurn();
            }
        }

        function showFinalResults() {
            // --- KOLOM KIRI: URUTAN TIBA ---
            const sortedByOrder = [...players].sort((a, b) => {
                if (a.isFinished && !b.isFinished) return -1;
                if (!a.isFinished && b.isFinished) return 1;
                if (a.isFinished && b.isFinished) return a.finishOrder - b.finishOrder;
                return b.health - a.health;
            });

            resultsOrderContainer.innerHTML = "";
            sortedByOrder.forEach((p, index) => {
                let statusClass = "";
                let statusText = "";
                if (p.isFinished) {
                    statusClass = "status-finish";
                    statusText = `Urutan #${p.finishOrder}`;
                } else if (p.isDead) {
                    statusClass = "status-dead";
                    statusText = "Meninggal";
                } else {
                    statusClass = "status-dead";
                    statusText = "Belum Selesai";
                }

                const div = document.createElement('div');
                div.className = "result-item";
                div.innerHTML = `
                    <div class="result-name">
                        <span style="color:#aaa; margin-right:5px;">${index + 1}.</span> ${p.name}
                    </div>
                    <div class="result-status ${statusClass}">${statusText}</div>
                `;
                resultsOrderContainer.appendChild(div);
            });

            // --- KOLOM KANAN: TERBANYAK HP ---
            const sortedByHP = [...players].sort((a, b) => {
                if (b.health !== a.health) {
                    return b.health - a.health;
                }

                return a.finishOrder - b.finishOrder;
            });

            resultsHPContainer.innerHTML = "";
            sortedByHP.forEach((p, index) => {
                let statusText = "";
                if (p.health === 100) statusText = "100% (Sempurna)";
                else if (p.health >= 80) statusText = `${p.health}% (Sehat)`;
                else if (p.health >= 60) statusText = `${p.health}% (Baik)`;
                else if (p.health >= 40) statusText = `${p.health}% (Kurang)`;
                else statusText = `${p.health}% (Kritis)`;

                const div = document.createElement('div');
                div.className = "result-item";
                div.innerHTML = `
                    <div class="result-name">
                        <span style="color:#aaa; margin-right:5px;">${index + 1}.</span> ${p.name}
                    </div>
                    <div class="result-status" style="background:${p.health > 0 ? '#3498db' : '#95a5a6'}">${statusText}</div>
                `;
                resultsHPContainer.appendChild(div);
            });

            gameOverModal.style.display = 'flex';
        }

        function nextTurn() {
            const p = players[currentPlayerIdx];
            p.previousTurnRoll = p.currentTurnRoll || 0;

            currentPlayerIdx = (currentPlayerIdx + 1) % 4;
            players[currentPlayerIdx].currentTurnRoll = 0;

            diceBtn.disabled = false;
            renderSidebar();

            const nextP = players[currentPlayerIdx];

            if (nextP.isFinished) {
                statusMessage.innerText = `Giliran: ${nextP.name} (FINIS)`;
                diceBtn.disabled = true;
                setTimeout(nextTurn, 1000);
            } else if (nextP.health <= 0) {
                statusMessage.innerText = `Giliran: ${nextP.name} (MATI)`;
                diceBtn.disabled = true;
                setTimeout(nextTurn, 1000);
            } else {
                statusMessage.innerText = `Giliran: ${nextP.name}`;
            }
        }

        window.addEventListener("DOMContentLoaded", () => {
            initTokens();
        });

        window.addEventListener("resize", () => {
            players.forEach(p => updateTokenPosition(p.id));
        });
    </script>

    <audio id="bg-music" src="asset/game musik.mp4" loop muted></audio>
    <script>
        const bgMusic = document.getElementById("bg-music");
        document.addEventListener("click", () => {
            bgMusic.muted = false;
            bgMusic.play();
        }, { once: true });
    </script>

</body>

</html>